fragment Organization_organization on Organization {
  id
  name
  shortName
  logo
  workspaces {
    totalItems
  }
  permissions {
    createWorkspace {
      isAllowed
      reasons
    }
    archiveWorkspace
    manageMembers
    manageOwners
    update
    delete
  }
  members {
    totalItems
  }
  externalCollaborators {
    totalItems
  }
  usage {
    users
    workspaces
    pipelineRuns
  }
  subscription {
    subscriptionId
    planCode
    startDate
    endDate
    isExpired
    isInGracePeriod
    limits {
      users
      workspaces
      pipelineRuns
    }
  }
}

query Organization($id: UUID!) {
  organization(id: $id) {
    ...Organization_organization
  }
}

query OrganizationWithWorkspaces($id: UUID!) {
  organization(id: $id) {
    ...Organization_organization
    workspaces {
      totalItems
      items {
        slug
        name
        countries {
          code
        }
      }
    }
  }
}

query Organizations($directMembershipOnly: Boolean) {
  organizations(directMembershipOnly: $directMembershipOnly) {
    id
    name
    logo
    workspaces {
      items {
        slug
        name
      }
    }
  }
}

fragment OrganizationDataset_link on DatasetLink {
  id
  workspace {
    slug
    name
  }
  dataset {
    id
    slug
    name
    description
    updatedAt
    sharedWithOrganization
    workspace {
      slug
      name
    }
    links(page: 1, perPage: 50) {
      items {
        workspace {
          slug
          name
        }
      }
    }
  }
}

query OrganizationDatasets(
  $id: UUID!
  $page: Int = 1
  $perPage: Int = 10
  $query: String
) {
  organization(id: $id) {
    ...Organization_organization
    datasetLinks(page: $page, perPage: $perPage, query: $query) {
      totalItems
      pageNumber
      totalPages
      items {
        ...OrganizationDataset_link
      }
    }
  }
}

fragment OrganizationWorkspace_workspace on Workspace {
  slug
  name
  createdAt
  updatedAt
  countries {
    code
  }
  createdBy {
    ...UserAvatar_user
  }
  members {
    totalItems
  }
  permissions {
    manageMembers
    delete
  }
}

query OrganizationWorkspaces(
  $organizationId: UUID!
  $page: Int = 1
  $perPage: Int = 10
  $query: String
) {
  organization(id: $organizationId) {
    ...Organization_organization
  }
  workspaces(
    organizationId: $organizationId
    page: $page
    perPage: $perPage
    query: $query
  ) {
    totalItems
    pageNumber
    totalPages
    items {
      ...OrganizationWorkspace_workspace
    }
  }
}
