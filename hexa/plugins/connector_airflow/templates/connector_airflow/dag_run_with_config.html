{% extends "layouts/page.html" %}
{% load embed %}

{% block page_title %}{{ dag.dag_id }}{% endblock %}

{% block page_content %}
    {% embed "ui/section/section.html" with title=_("Specify configuration") %}
        {% slot content %}
            <!-- TEST-KEY: SET_DAG_CONFIG -->
            <form method="post" action="{% url "connector_airflow:dag_run_create" cluster_id=dag.cluster_id dag_id=dag.id %}">
                {% csrf_token %}
                {% if error %}
                    <p class="mt-4 mb-2 text-sm text-red-600">{{ error }}</p>
                    <textarea name="dag_config" rows="10" class="w-full form-textarea resize-none shadow-sm block w-full focus:ring-red-500 focus:border-red-500 sm:text-sm border-red-300 rounded-md">{{ form_config }}</textarea>
                {% else %}
                    <textarea name="dag_config" rows="10" class="w-full form-textarea resize-none shadow-sm block w-full focus:ring-blue-500 focus:border-blue-500 sm:text-sm border-gray-300 rounded-md">{{ form_config }}</textarea>
                {% endif %}
                <input  type="submit" value="Run with configuration" class="group relative my-4 py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"/>
            </form>

            {% if ref_config != form_config %}
                <p class="my-4">Pipeline sample configuration:</p>
                <pre>{{ ref_config }}</pre>
            {% endif %}
        {% endslot %}
    {% endembed %}
{% endblock %}
