from hexa.core.test import GraphQLTestCase
from hexa.user_management.models import User


class SchemaTest(GraphQLTestCase):
    USER_JIM = None

    @classmethod
    def setUpTestData(cls):
        cls.USER_JIM = User.objects.create_user(
            "jim@bluesquarehub.com",
            "jimspassword",
        )

    def test_country_code(self):
        self.client.force_login(self.USER_JIM)
        r = self.run_query(
            """
              query {
                country(code: "BF") {
                  code
                  name
                  alpha3
                  whoInfo {
                    region {
                      code
                      name
                    }
                    defaultCRS
                    simplifiedExtent
                  }
                }
              }
            """,
        )

        self.assertEqual(
            {
                "name": "Burkina Faso",
                "code": "BF",
                "alpha3": "BFA",
                "whoInfo": {
                    "region": {"code": "AFRO", "name": "African Region"},
                    "defaultCRS": 32630,
                    "simplifiedExtent": [SIMPLIFIED_BFA_EXTENT],
                },
            },
            r["data"]["country"],
        )

    def test_country_alpha3(self):
        self.client.force_login(self.USER_JIM)
        r = self.run_query(
            """
              query {
                country(alpha3: "BFA") {
                  code
                  name
                  alpha3
                  flag
                  whoInfo {
                    region {
                      code
                      name
                    }
                    defaultCRS
                    simplifiedExtent
                  }
                }
              }
            """,
        )

        self.assertEqual(
            {
                "name": "Burkina Faso",
                "code": "BF",
                "alpha3": "BFA",
                "flag": "http://app.openhexa.test/static/flags/bf.gif",
                "whoInfo": {
                    "region": {"code": "AFRO", "name": "African Region"},
                    "defaultCRS": 32630,
                    "simplifiedExtent": [SIMPLIFIED_BFA_EXTENT],
                },
            },
            r["data"]["country"],
        )

    def test_countries(self):
        self.client.force_login(self.USER_JIM)
        r = self.run_query(
            """
                  query {
                    countries {
                      code
                      name
                      alpha3
                    }
                  }
                """,
        )

        self.assertEqual(
            {
                "name": "Burkina Faso",
                "code": "BF",
                "alpha3": "BFA",
            },
            next(c for c in r["data"]["countries"] if c["alpha3"] == "BFA"),
        )


SIMPLIFIED_BFA_EXTENT = [
    [-5.512325279938124, 10.429284152722984],
    [-5.468973300397598, 10.555089017492929],
    [-5.478191252774922, 10.622767363865991],
    [-5.464259537571561, 10.667676900906619],
    [-5.467612235666233, 10.764977998120823],
    [-5.435213764965767, 10.804130753936077],
    [-5.427619224168779, 10.840448846506861],
    [-5.458052147871272, 10.932912786757026],
    [-5.491986641363371, 10.975485417224602],
    [-5.488314496387944, 11.082899569453753],
    [-5.387458447875063, 11.105060152477913],
    [-5.3438156415439, 11.13817922038862],
    [-5.322860824346302, 11.208008936096137],
    [-5.261423321538266, 11.270047498963752],
    [-5.253327541601519, 11.368577464275784],
    [-5.207600829907204, 11.472920441858559],
    [-5.222765335409081, 11.564684826071591],
    [-5.294599510406014, 11.615945238302244],
    [-5.270965668921523, 11.685005846398493],
    [-5.280954452659461, 11.746999877752582],
    [-5.318213034618609, 11.784811755573394],
    [-5.405087001432517, 11.828102664678916],
    [-5.246069497728413, 11.864819785573863],
    [-5.144049208340268, 11.94844941969214],
    [-5.07390354308713, 11.98232375283845],
    [-4.844147778937709, 12.017867919236657],
    [-4.756894724853808, 12.017925391679237],
    [-4.700235560395149, 12.065753101306427],
    [-4.656113310706091, 12.082210461781644],
    [-4.615999155787047, 12.12564096470945],
    [-4.579541208873755, 12.202660139348058],
    [-4.488870374954251, 12.283946075520479],
    [-4.444261422157338, 12.373371115066432],
    [-4.403944680927059, 12.515323038331378],
    [-4.409903533806784, 12.584285899521873],
    [-4.480127431659704, 12.658698690048663],
    [-4.477845947612809, 12.724894692666215],
    [-4.413296685495095, 12.71859105997161],
    [-4.350438718466899, 12.742989829387463],
    [-4.283139345325572, 12.741109542687454],
    [-4.238376786241002, 12.771355526154462],
    [-4.22186507807099, 12.803344123035266],
    [-4.225014678066424, 12.945973926730598],
    [-4.265354848584583, 12.991107651458368],
    [-4.286528360487381, 13.050592541741256],
    [-4.346518688695459, 13.118452278685604],
    [-4.339382705206608, 13.144316982567634],
    [-4.258638319212023, 13.23657037858588],
    [-4.143005781066871, 13.29693223900058],
    [-4.110951476562422, 13.337725402629912],
    [-4.097928368246615, 13.390288896247208],
    [-4.004796798654591, 13.44588751281141],
    [-3.965326262702501, 13.50506419310449],
    [-3.896028118929738, 13.442574289623455],
    [-3.865160761413543, 13.392955771113309],
    [-3.794727728025908, 13.37070537769716],
    [-3.719211036394497, 13.297153022717751],
    [-3.568930645665726, 13.199185273803852],
    [-3.489016912281843, 13.206879970981657],
    [-3.437217610544274, 13.276309747097946],
    [-3.303841102023257, 13.298415063835083],
    [-3.276976363491552, 13.320398152547597],
    [-3.256774774876604, 13.367446592476062],
    [-3.277818823228924, 13.556714981659232],
    [-3.256394468777607, 13.587332251168714],
    [-3.248408071137467, 13.635358057951372],
    [-3.270160200843141, 13.705500057772324],
    [-3.214428607913733, 13.706710310483222],
    [-3.159893325591425, 13.683455368545369],
    [-3.105131956389691, 13.687524151245828],
    [-3.041096317133192, 13.653820901057689],
    [-2.983932122632418, 13.658032975413569],
    [-2.935065806937053, 13.682084902642176],
    [-2.908640816204587, 13.728928388797577],
    [-2.907755170324744, 13.824124619066286],
    [-2.853725544622696, 13.94514516154102],
    [-2.854555845195561, 14.006227077514895],
    [-2.83482410346723, 14.056845217762982],
    [-2.677562551698521, 14.135925500598988],
    [-2.474125453411758, 14.299453873941642],
    [-2.293473853831907, 14.247391121743425],
    [-2.128496630296797, 14.16426724477594],
    [-2.048008256122912, 14.170893703886978],
    [-1.996250214820082, 14.231268391710122],
    [-1.98001411090834, 14.475345580965342],
    [-1.90106862193733, 14.489218060249792],
    [-1.765798044537834, 14.484548624993447],
    [-1.678573664620323, 14.50303575697044],
    [-1.318065404505796, 14.729512829750421],
    [-1.062809940228052, 14.795235102782337],
    [-0.724705396893831, 15.083673255620344],
    [-0.443385230073782, 15.083621623923813],
    [-0.419480999589616, 15.05338598697035],
    [-0.368420520965996, 15.031851214319811],
    [-0.331171604603237, 15.03538025065444],
    [-0.245619456505008, 15.078420469608886],
    [0.243714539844857, 14.913825038015435],
    [0.206469670778751, 14.85774554719661],
    [0.20825519502613, 14.80256101963861],
    [0.236811058590019, 14.75260447046442],
    [0.174245678952726, 14.632459960767976],
    [0.166801166338569, 14.527152172112283],
    [0.383457379661275, 14.053393819632115],
    [0.472856863064765, 13.943750194983735],
    [0.495223655734808, 13.893051057863092],
    [0.625359347964222, 13.773823859058279],
    [0.658234399920805, 13.708937916879433],
    [0.707419443384139, 13.687756756781303],
    [0.770374462950512, 13.690441932534247],
    [0.837486903262322, 13.634197838073142],
    [0.993815483893627, 13.577393502292079],
    [1.057477155876642, 13.475012106402808],
    [1.141817815423514, 13.41856185621619],
    [1.242418718243453, 13.391178313050311],
    [1.285345058790559, 13.354388682958882],
    [1.186485387072511, 13.321013654627517],
    [1.082343021501781, 13.340389421129053],
    [1.018609535176517, 13.313252709376306],
    [0.99239384767405, 13.250221238765173],
    [0.9944011468266, 13.136615406907952],
    [1.009925181090092, 13.102384149818208],
    [1.809786535666089, 12.640868094947407],
    [1.87754625010463, 12.643742087225935],
    [1.979542266136352, 12.735286854542288],
    [2.106802687172697, 12.728570177442984],
    [2.162998256919419, 12.690007633373593],
    [2.229037259356184, 12.583871511407686],
    [2.232897589487757, 12.534513274540517],
    [2.271889889801846, 12.472569325253584],
    [2.277705734590175, 12.425538914102667],
    [2.151545581510197, 12.399349351364394],
    [2.116304021388434, 12.357533698335951],
    [2.111923326538542, 12.30340084329549],
    [2.403664461919262, 11.900103365504584],
    [2.375268842972106, 11.790635953214776],
    [2.316376895590095, 11.73340703399822],
    [2.307405531414036, 11.666160905407633],
    [2.128828431764715, 11.538290954077771],
    [2.020488670001382, 11.414720040183097],
    [1.916509289520475, 11.40922426657052],
    [1.845806472269917, 11.439042805389397],
    [1.621352076123677, 11.393757558550412],
    [1.52802348769122, 11.452004155986504],
    [1.43720069980447, 11.44521838452291],
    [1.359970070353028, 11.361197708864898],
    [1.35053659932213, 11.305964648527139],
    [1.185298245294651, 11.21799107682453],
    [1.163027140543926, 11.168457846918503],
    [1.117068822426896, 11.117596958671234],
    [1.108867760364793, 11.030856766345039],
    [1.071112033144829, 11.049531396249014],
    [1.001059277332809, 11.052464079107205],
    [0.916576178739219, 11.000606341800417],
    [0.663468585502021, 10.998237989963041],
    [0.500554309443723, 10.932998234705744],
    [0.487175149813523, 10.98379291677892],
    [0.445499893622473, 11.019411838402538],
    [-0.196287439264317, 11.154785994927567],
    [-0.245942226711091, 11.145057948853996],
    [-0.36103725758366, 11.0687492936029],
    [-0.48221989918357, 11.016763171286497],
    [-0.617986294966522, 10.910994539514148],
    [-0.693087901511134, 10.980662919873337],
    [-0.746301856255362, 10.997329716517045],
    [-0.81651551827752, 10.996814413902129],
    [-0.892993231698158, 10.963220203263369],
    [-0.941804638225624, 10.99364406951252],
    [-1.027794896732018, 11.006020872395746],
    [-1.119139363616135, 10.985967498708106],
    [-1.38624554557674, 10.986602725831732],
    [-1.464194981418389, 11.021372767777288],
    [-1.535503288375192, 11.019178290068727],
    [-1.584620016314885, 10.990152747463352],
    [-1.700206692335264, 10.976700021243502],
    [-2.762882233003203, 10.996040551510248],
    [-2.805512874152227, 10.960063535268727],
    [-2.869232872689283, 10.846911991939493],
    [-2.907355452200065, 10.737911994381403],
    [-2.906265054755271, 10.6845951896555],
    [-2.927299086765328, 10.619256986683345],
    [-2.865115893227415, 10.470260038497168],
    [-2.827388119955412, 10.437765370291254],
    [-2.773947600146468, 10.422641417317156],
    [-2.808337802276859, 10.353718265487633],
    [-2.799526520834531, 10.30186121183257],
    [-2.756498293039676, 10.243766203338932],
    [-2.787349714056593, 10.181474056049273],
    [-2.788380965294237, 10.069077824417198],
    [-2.743011592413311, 9.957647019536795],
    [-2.756294471387413, 9.890665571213063],
    [-2.726843552664874, 9.827155845921487],
    [-2.764692898130812, 9.783300243077488],
    [-2.77735448165659, 9.7304257997873],
    [-2.746396184714758, 9.641976696838197],
    [-2.74817782244574, 9.56620018082247],
    [-2.687726056775315, 9.491729879262651],
    [-2.758664777923326, 9.411791714966347],
    [-2.826777223558103, 9.45456556779684],
    [-2.935259227400752, 9.576781602803104],
    [-2.984590302486526, 9.68514568587797],
    [-3.011410479985087, 9.71142826451681],
    [-3.062076214159515, 9.730009033683341],
    [-3.123336846194906, 9.815057142780207],
    [-3.210228383094069, 9.850262447501144],
    [-3.273431604925813, 9.84677722644044],
    [-3.373680473515442, 9.912584840013691],
    [-3.472548941050918, 9.932921491797963],
    [-3.73352709815485, 9.93251111390879],
    [-3.803414056687719, 9.895272305972727],
    [-3.895906192710429, 9.89307209167088],
    [-3.973048245844909, 9.83341181414696],
    [-4.051274676401816, 9.803478373828245],
    [-4.141977800360723, 9.811909721376713],
    [-4.2539724998338, 9.73617122259642],
    [-4.285787731650499, 9.635143298480045],
    [-4.311478662262313, 9.597537597423836],
    [-4.386055412841866, 9.594741747095242],
    [-4.441496537814094, 9.64106699815529],
    [-4.505242638037666, 9.647345924822154],
    [-4.540038114902432, 9.679897777132407],
    [-4.601706559147045, 9.697600052221064],
    [-4.687846097462448, 9.677957780822682],
    [-4.732030804143405, 9.720626823394712],
    [-4.780336899203003, 9.741362252835552],
    [-4.845437664110692, 9.846531341485653],
    [-4.877445120997208, 9.865860720304257],
    [-4.929761266808558, 9.86884906279247],
    [-4.967059063914571, 9.893130304889072],
    [-4.970107474552489, 9.95503686222396],
    [-4.998357564943778, 10.0385113356587],
    [-5.055500203788493, 10.083374897626088],
    [-5.156542961019738, 10.272074989578268],
    [-5.234946930515098, 10.305927104258403],
    [-5.362274689434932, 10.282818840750481],
    [-5.402912374286019, 10.296280770962984],
    [-5.460679873056939, 10.34631875313215],
    [-5.512325279938124, 10.429284152722984],
]
