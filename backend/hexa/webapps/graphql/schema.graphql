"""
Directive to ensure exactly one field is provided in an input type.
"""
directive @oneOf on INPUT_OBJECT

"""
Represents the type of a web app.
"""
enum WebappType {
  IFRAME
  HTML
  BUNDLE
  SUPERSET
}

"""
Represents a web app.
"""
type Webapp {
  id: UUID!
  slug: String!
  name: String!
  description: String
  url: String
  type: WebappType!
  icon: String
  content: String
  workspace: Workspace!
  createdBy: User!
  isFavorite: Boolean!
  isShortcut: Boolean!
  isPublic: Boolean!
  permissions: WebappPermissions!
}
"""
Represents the permissions for a web app.
"""
type WebappPermissions {
  update: Boolean!  # Indicates if the webapp can be updated.
  delete: Boolean!  # Indicates if the webapp can be deleted.
}

"""
Content input for an IFRAME webapp.
"""
input IframeWebappContentInput {
  url: String!
}

"""
Content input for an HTML webapp.
"""
input HtmlWebappContentInput {
  content: String!
}

"""
Content input for a BUNDLE webapp.
"""
input BundleWebappContentInput {
  bundle: String!
}

"""
Content input for a SUPERSET webapp.
"""
input SupersetWebappContentInput {
  url: String!
}

"""
Content input for a webapp. Exactly one field must be provided.
"""
input WebappContentInput @oneOf {
  iframe: IframeWebappContentInput
  html: HtmlWebappContentInput
  bundle: BundleWebappContentInput
  superset: SupersetWebappContentInput
}

"""
Represents the input for creating a web app.
"""
input CreateWebappInput {
  name: String!
  description: String
  icon: String
  content: WebappContentInput!
  workspaceSlug: String!
}

"""
Represents the result of creating a web app.
"""
type CreateWebappResult {
  success: Boolean!
  errors: [CreateWebappError!]!
  webapp: Webapp
}
"""
Represents the error message for a web app creation.
"""
enum CreateWebappError {
  WORKSPACE_NOT_FOUND
  PERMISSION_DENIED
  ALREADY_EXISTS
}

"""
Represents the input for updating a web app.
"""
input UpdateWebappInput {
  id: UUID!
  name: String
  description: String
  icon: String
  content: WebappContentInput
  isPublic: Boolean
}

"""
Represents the result of updating a web app.
"""
type UpdateWebappResult {
  success: Boolean!
  errors: [UpdateWebappError!]!
  webapp: Webapp
}

"""
Represents the error message for a web app update.
"""
enum UpdateWebappError {
  WEBAPP_NOT_FOUND
  PERMISSION_DENIED
}

"""
Represents the input for deleting a web app.
"""
input DeleteWebappInput {
  id: UUID!
}

"""
Represents the result of deleting a web app.
"""
type DeleteWebappResult {
  success: Boolean!
  errors: [DeleteWebappError!]!
}
"""
Represents the error message for a web app deletion.
"""
enum DeleteWebappError {
  WEBAPP_NOT_FOUND
  PERMISSION_DENIED
}

"""
Represents the input for adding a web app to favorites.
"""
input AddToFavoritesInput {
  webappId: ID!
}

"""
Represents the result of adding a web app to favorites.
"""
type AddToFavoritesResult {
  success: Boolean!
  errors: [AddToFavoritesError!]!
}
"""
Represents the error message for adding a web app to favorites.
"""
enum AddToFavoritesError {
  WEBAPP_NOT_FOUND
}

"""
Represents the input for removing a web app from favorites.
"""
input RemoveFromFavoritesInput {
  webappId: ID!
}

"""
Represents the result of removing a web app from favorites.
"""
type RemoveFromFavoritesResult {
  success: Boolean!
  errors: [RemoveFromFavoritesError!]!
}

"""
Represents the error message for removing a web app from favorites.
"""
enum RemoveFromFavoritesError {
  WEBAPP_NOT_FOUND
}

"""
Represents a page of webapps.
"""
type WebappsPage {
  items: [Webapp!]!  # The list of webapps on the current page.
  pageNumber: Int!  # The current page number.
  totalPages: Int!  # The total number of pages.
  totalItems: Int!  # The total number of pipelines.
}

extend type Query {
  webapp(workspaceSlug: String!, slug: String!): Webapp @loginRequired
  webapps(workspaceSlug: String, favorite: Boolean, page: Int, perPage: Int): WebappsPage! @loginRequired
  publicWebapp(workspaceSlug: String!, slug: String!): Webapp
}

extend type Mutation {
  createWebapp(input: CreateWebappInput!): CreateWebappResult! @loginRequired
  updateWebapp(input: UpdateWebappInput!): UpdateWebappResult! @loginRequired
  deleteWebapp(input: DeleteWebappInput!): DeleteWebappResult! @loginRequired
  addToFavorites(input: AddToFavoritesInput!): AddToFavoritesResult! @loginRequired
  removeFromFavorites(input: RemoveFromFavoritesInput!): RemoveFromFavoritesResult! @loginRequired
}